// Oneline v0.6.0
// @author Nadir Hamid
// @license MIT
function clone(t,e){if(null==t||"object"!=typeof t)return t;if(void 0==e)e=[];else{var r,n=e.length;for(r=0;n>r;r++)if(t===e[r])return t}if(e.push(t),"function"==typeof t.clone)return t.clone(!0);if("[object Array]"==Object.prototype.toString.call(t)){o=t.slice();for(var r=o.length;r--;)o[r]=clone(o[r],e);return o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);if(t.nodeType&&"function"==typeof t.cloneNode)return t.cloneNode(!0);var i=Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__;i||(i=t.constructor.prototype);var o=object_create(i);for(var f in t)o[f]=clone(t[f],e);return o}var bson=function(){function t(){return a()}function e(){return r(Array.prototype.join.call(arguments,"/"))}function r(t){for(var e,r,n=[],i=t.split("/"),o=0,f=i.length-1;f>=o;o++)e=i[o],("."!==e||void 0===r)&&(".."===e&&n.length&&".."!==r&&"."!==r&&void 0!==r?(n.pop(),r=n.slice(-1)[0]):("."===r&&n.pop(),n.push(e),r=e));return n.join("/")}function n(t){return t&&t.substr(0,t.lastIndexOf("/"))||"."}function i(t,r){for(var i,o,f=e(n(t.id),/\.\/$/.test(r)?r+"index":r).replace(/\.js$/,""),s=e(f,"index"),u=t.pkg,a=u.modules.length;a-->0;)if(o=u.modules[a].id,o==f||o==s){i=u.modules[a];break}return i}function o(t){function e(r){var n,o;if(/^\./.test(r))n=i(t,r);else{if(u&&u.hasOwnProperty(r))return u[r];if(aliases&&aliases.hasOwnProperty(r))return e(aliases[r]);if(o=h[r],!o&&l){try{o=l(r)}catch(f){}if(o)return o}if(!o)throw new Error('Cannot find module "'+r+'" @[module: '+t.id+" package: "+t.pkg.name+"]");n=o.index}if(!n)throw new Error('Cannot find module "'+r+'" @[module: '+t.id+" package: "+t.pkg.name+"]");return n.parent=t,n.call()}return e}function f(t,e,r){var n={pkg:t,id:e,wrapper:r},i=!1;n.exports={},n.require=o(n),n.call=function(){return i?n.exports:(i=!0,c.require=n.require,n.wrapper(n,n.exports,c,c.require),n.exports)},t.mainModuleId==n.id&&(t.index=n,0===t.parents.length&&(a=n.call)),t.modules.push(n)}function s(){var t=arguments[arguments.length-1],e=Array.prototype.slice.call(arguments,0,arguments.length-1),r=t(e);return h[r.name]=r,1==arguments.length&&(h.main=r),function(t){var e;for(e in t)f(r,e,t[e])}}var u,a,h={},c={},l="undefined"!=typeof require&&require;return t.main=t,t.module=f,t.packages=h,t.pkg=s,t.require=function(t){return h.main.index.require(t)},u={},aliases={},t}(this);bson.pkg(function(t){return{name:"bson",mainModuleId:"bson",modules:[],parents:t}})({binary:function(t,e,r,n){function i(t,e){if(!(this instanceof i))return new i(t,e);if(this._bsontype="Binary",t instanceof Number?(this.sub_type=t,this.position=0):(this.sub_type=null==e?f:e,this.position=0),null==t||t instanceof Number)this.buffer="undefined"!=typeof o?new o(i.BUFFER_SIZE):"undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(i.BUFFER_SIZE)):new Array(i.BUFFER_SIZE),this.position=0;else{if("string"==typeof t)if("undefined"!=typeof o)this.buffer=new o(t);else{if("undefined"==typeof Uint8Array&&"[object Array]"!=Object.prototype.toString.call(t))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=s(t)}else this.buffer=t;this.position=t.length}}if("undefined"==typeof window)var o=n("buffer").Buffer;var f=0,s=function(t){for(var e="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t.length)):new Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e},u=function(t,e,r){for(var n="",i=e;r>i;i++)n+=String.fromCharCode(t[i]);return n};i.prototype.put=function(t){if(null!=t.length&&"number"!=typeof t&&1!=t.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof t&&0>t||t>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var e=null;if(e="string"==typeof t?t.charCodeAt(0):null!=t.length?t[0]:t,this.buffer.length>this.position)this.buffer[this.position++]=e;else if("undefined"!=typeof o&&o.isBuffer(this.buffer)){var r=new o(i.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r,this.buffer[this.position++]=e}else{var r=null;r="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(i.BUFFER_SIZE+this.buffer.length)):new Array(i.BUFFER_SIZE+this.buffer.length);for(var n=0;n<this.buffer.length;n++)r[n]=this.buffer[n];this.buffer=r,this.buffer[this.position++]=e}},i.prototype.write=function(t,e){if(e="number"==typeof e?e:this.position,this.buffer.length<e+t.length){var r=null;if("undefined"!=typeof o&&o.isBuffer(this.buffer))r=new o(this.buffer.length+t.length),this.buffer.copy(r,0,0,this.buffer.length);else if("[object Uint8Array]"==Object.prototype.toString.call(this.buffer)){r=new Uint8Array(new ArrayBuffer(this.buffer.length+t.length));for(var n=0;n<this.position;n++)r[n]=this.buffer[n]}this.buffer=r}if("undefined"!=typeof o&&o.isBuffer(t)&&o.isBuffer(this.buffer))t.copy(this.buffer,e,0,t.length),this.position=e+t.length>this.position?e+t.length:this.position;else if("undefined"!=typeof o&&"string"==typeof t&&o.isBuffer(this.buffer))this.buffer.write(t,"binary",e),this.position=e+t.length>this.position?e+t.length:this.position;else if("[object Uint8Array]"==Object.prototype.toString.call(t)||"[object Array]"==Object.prototype.toString.call(t)&&"string"!=typeof t){for(var n=0;n<t.length;n++)this.buffer[e++]=t[n];this.position=e>this.position?e:this.position}else if("string"==typeof t){for(var n=0;n<t.length;n++)this.buffer[e++]=t.charCodeAt(n);this.position=e>this.position?e:this.position}},i.prototype.read=function(t,e){if(e=e&&e>0?e:this.position,this.buffer.slice)return this.buffer.slice(t,t+e);for(var r="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e)):new Array(e),n=0;e>n;n++)r[n]=this.buffer[t++];return r},i.prototype.value=function(t){if(t=null==t?!1:t,"undefined"!=typeof o&&o.isBuffer(this.buffer))return t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(t){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var e="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),r=0;r<this.position;r++)e[r]=this.buffer[r];return e}return u(this.buffer,0,this.position)},i.prototype.length=function(){return this.position},i.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},i.prototype.toString=function(t){return null!=this.buffer?this.buffer.slice(0,this.position).toString(t):""},i.BUFFER_SIZE=256,i.SUBTYPE_DEFAULT=0,i.SUBTYPE_FUNCTION=1,i.SUBTYPE_BYTE_ARRAY=2,i.SUBTYPE_UUID_OLD=3,i.SUBTYPE_UUID=4,i.SUBTYPE_MD5=5,i.SUBTYPE_USER_DEFINED=128,e.Binary=i},binary_parser:function(t,e,n,i){function o(t,e){return this instanceof o?(this.bigEndian=t,void(this.allowExceptions=e)):new o(t,e)}function f(t,e){this.bigEndian=t||0,this.buffer=[],this.setBuffer(e)}for(var s=String.fromCharCode,u=[],a=0;64>a;a++)u[a]=Math.pow(2,a);o.warn=function(t){if(this.allowExceptions)throw new Error(t);return 1},o.decodeFloat=function(t,e,r){var n=new this.Buffer(this.bigEndian,t);n.checkBuffer(e+r+1);var i=u[r-1]-1,o=n.readBits(e+r,1),f=n.readBits(e,r),s=0,a=2,h=n.buffer.length+(-e>>3)-1;do for(var c=n.buffer[++h],l=e%8||8,p=1<<l;p>>=1;c&p&&(s+=1/a),a*=2);while(e-=l);return f==(i<<1)+1?s?0/0:o?-1/0:+1/0:(1+-2*o)*(f||s?f?Math.pow(2,f-i)*(1+s):Math.pow(2,-i+1)*s:0)},o.decodeInt=function(t,e,r,n){var i=new this.Buffer(this.bigEndian||n,t),o=i.readBits(0,e),f=u[e];return r&&o>=f/2?o-f:o},o.encodeFloat=function(t,e,n){var i,o,f,s,a,h=u[n-1]-1,c=-h+1,l=h,p=c-e,_=parseFloat(t),g=isNaN(_)||_==-1/0||_==+1/0?_:0,y=0,B=2*h+1+e+3,d=new Array(B),O=(_=0!==g?0:_)<0,b=Math.floor(_=Math.abs(_)),m=_-b;for(s=B;s;d[--s]=0);for(s=h+2;b&&s;d[--s]=b%2,b=Math.floor(b/2));for(s=h+1;m>0&&s;(d[++s]=((m*=2)>=1)-0)&&--m);for(s=-1;++s<B&&!d[s];);if(d[(i=e-1+(s=(y=h+1-s)>=c&&l>=y?s+1:h+1-(y=c-1)))+1]){if(!(o=d[i]))for(a=i+2;!o&&B>a;o=d[a++]);for(a=i+1;o&&--a>=0;(d[a]=!d[a]-0)&&(o=0));}for(s=0>s-2?-1:s-3;++s<B&&!d[s];);for((y=h+1-s)>=c&&l>=y?++s:c>y&&(y!=h+1-B&&p>y&&this.warn("encodeFloat::float underflow"),s=h+1-(y=c-1)),(b||0!==g)&&(this.warn(b?"encodeFloat::float overflow":"encodeFloat::"+g),y=l+1,s=h+2,g==-1/0?O=1:isNaN(g)&&(d[s]=1)),_=Math.abs(y+h),a=n+1,f="";--a;f=_%2+f,_=_>>=1);for(_=0,a=0,s=(f=(O?"1":"0")+f+d.slice(s,s+e).join("")).length,r=[];s;a=(a+1)%8)_+=(1<<a)*f.charAt(--s),7==a&&(r[r.length]=String.fromCharCode(_),_=0);return r[r.length]=_?String.fromCharCode(_):"",(this.bigEndian?r.reverse():r).join("")},o.encodeInt=function(t,e,r,n){var i=u[e];(t>=i||-(i/2)>t)&&(this.warn("encodeInt::overflow"),t=0),0>t&&(t+=i);for(var o=[];t;o[o.length]=String.fromCharCode(t%256),t=Math.floor(t/256));for(e=-(-e>>3)-o.length;e--;o[o.length]="\x00");return(this.bigEndian||n?o.reverse():o).join("")},o.toSmall=function(t){return this.decodeInt(t,8,!0)},o.fromSmall=function(t){return this.encodeInt(t,8,!0)},o.toByte=function(t){return this.decodeInt(t,8,!1)},o.fromByte=function(t){return this.encodeInt(t,8,!1)},o.toShort=function(t){return this.decodeInt(t,16,!0)},o.fromShort=function(t){return this.encodeInt(t,16,!0)},o.toWord=function(t){return this.decodeInt(t,16,!1)},o.fromWord=function(t){return this.encodeInt(t,16,!1)},o.toInt=function(t){return this.decodeInt(t,32,!0)},o.fromInt=function(t){return this.encodeInt(t,32,!0)},o.toLong=function(t){return this.decodeInt(t,64,!0)},o.fromLong=function(t){return this.encodeInt(t,64,!0)},o.toDWord=function(t){return this.decodeInt(t,32,!1)},o.fromDWord=function(t){return this.encodeInt(t,32,!1)},o.toQWord=function(t){return this.decodeInt(t,64,!0)},o.fromQWord=function(t){return this.encodeInt(t,64,!0)},o.toFloat=function(t){return this.decodeFloat(t,23,8)},o.fromFloat=function(t){return this.encodeFloat(t,23,8)},o.toDouble=function(t){return this.decodeFloat(t,52,11)},o.fromDouble=function(t){return this.encodeFloat(t,52,11)},o.encode_int32=function(t,e){var r,n,i,o,f;return f=0>t?t+4294967296:t,r=Math.floor(f/16777215),f&=16777215,n=Math.floor(f/65535),f&=65535,i=Math.floor(f/255),f&=255,o=Math.floor(f),e?[s(r),s(n),s(i),s(o)]:s(r)+s(n)+s(i)+s(o)},o.encode_int64=function(t){var e,r,n,i,o,f,u,a,h;return h=0>t?t+0x10000000000000000:t,e=Math.floor(h/72057594037927940),h&=72057594037927940,r=Math.floor(h/0xffffffffffff),h&=0xffffffffffff,n=Math.floor(h/0xffffffffff),h&=0xffffffffff,i=Math.floor(h/4294967295),h&=4294967295,o=Math.floor(h/16777215),h&=16777215,f=Math.floor(h/65535),h&=65535,u=Math.floor(h/255),h&=255,a=Math.floor(h),s(e)+s(r)+s(n)+s(i)+s(o)+s(f)+s(u)+s(a)},o.decode_utf8=function(t){for(var e,r=t.length,n="",i=0,o=0,f=0;r>i;)o=t.charCodeAt(i),128>o?(n+=String.fromCharCode(o),i++):o>191&&224>o?(f=t.charCodeAt(i+1),n+=String.fromCharCode((31&o)<<6|63&f),i+=2):(f=t.charCodeAt(i+1),e=t.charCodeAt(i+2),n+=String.fromCharCode((15&o)<<12|(63&f)<<6|63&e),i+=3);return n},o.encode_cstring=function(t){return unescape(encodeURIComponent(t))+o.fromByte(0)},o.encode_utf8=function(t){for(var e,r="",n=0,i=t.length;i>n;n++)e=t.charCodeAt(n),128>e?r+=String.fromCharCode(e):e>127&&2048>e?(r+=String.fromCharCode(e>>6|192),r+=String.fromCharCode(63&e|128)):(r+=String.fromCharCode(e>>12|224),r+=String.fromCharCode(e>>6&63|128),r+=String.fromCharCode(63&e|128));return r},o.hprint=function(t){for(var e,r=0,n=t.length;n>r;r++)t.charCodeAt(r)<32?(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(e+" ")):(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(e+" "));process.stdout.write("\n\n")},o.ilprint=function(t){for(var e,r=0,n=t.length;n>r;r++)t.charCodeAt(r)<32?(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),i("util").debug(e+" : ")):(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),i("util").debug(e+" : "+t.charAt(r)))},o.hlprint=function(t){for(var e,r=0,n=t.length;n>r;r++)t.charCodeAt(r)<32?(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),i("util").debug(e+" : ")):(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),i("util").debug(e+" : "+t.charAt(r)))},f.prototype.setBuffer=function(t){var e,r,n;if(t){for(r=e=t.length,n=this.buffer=new Array(e);r;n[e-r]=t.charCodeAt(--r));this.bigEndian&&n.reverse()}},f.prototype.hasNeededBits=function(t){return this.buffer.length>=-(-t>>3)},f.prototype.checkBuffer=function(t){if(!this.hasNeededBits(t))throw new Error("checkBuffer::missing bytes")},f.prototype.readBits=function(t,e){function r(t,e){for(;e--;t=1073741824==(1073741824&(t%=2147483648))?2*t:2*(t-1073741824)+2147483647+1);return t}if(0>t||0>=e)return 0;this.checkBuffer(t+e);for(var n,i=t%8,o=this.buffer.length-(t>>3)-1,f=this.buffer.length+(-(t+e)>>3),s=o-f,u=(this.buffer[o]>>i&(1<<(s?8-i:e))-1)+(s&&(n=(t+e)%8)?(this.buffer[f++]&(1<<n)-1)<<(s--<<3)-i:0);s;u+=r(this.buffer[f++],(s--<<3)-i));return u},o.Buffer=f,e.BinaryParser=o},bson:function(module,exports,global,require,undefined){function BSON(){}function calculateElement(t,e,r){var n="undefined"!=typeof Buffer;switch(typeof e){case"string":return 1+(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1+4+(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1;case"number":return Math.floor(e)===e&&e>=BSON.JS_INT_MIN&&e<=BSON.JS_INT_MAX&&e>=BSON.BSON_INT32_MIN&&e<=BSON.BSON_INT32_MAX?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+5:(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+9;case"undefined":return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1;case"boolean":return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+2;case"object":if(null==e||e instanceof MinKey||e instanceof MaxKey||"MinKey"==e._bsontype||"MaxKey"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1;if(e instanceof ObjectID||"ObjectID"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+13;if(e instanceof Date||isDate(e))return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+6+e.length;if(e instanceof Long||e instanceof Double||e instanceof Timestamp||"Long"==e._bsontype||"Double"==e._bsontype||"Timestamp"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+9;if(e instanceof Code||"Code"==e._bsontype)return null!=e.scope&&Object.keys(e.scope).length>0?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+4+(n?Buffer.byteLength(e.code.toString(),"utf8"):numberOfBytes(e.code.toString()))+1+BSON.calculateObjectSize(e.scope,r):(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+(n?Buffer.byteLength(e.code.toString(),"utf8"):numberOfBytes(e.code.toString()))+1;if(e instanceof Binary||"Binary"==e._bsontype)return e.sub_type==Binary.SUBTYPE_BYTE_ARRAY?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+(e.position+1+4+1+4):(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+(e.position+1+4+1);if(e instanceof Symbol||"Symbol"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+((n?Buffer.byteLength(e.value,"utf8"):numberOfBytes(e.value))+4+1+1);if(e instanceof DBRef||"DBRef"==e._bsontype){var i={$ref:e.namespace,$id:e.oid};return null!=e.db&&(i.$db=e.db),(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+BSON.calculateObjectSize(i,r)}return e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+(n?Buffer.byteLength(e.source,"utf8"):numberOfBytes(e.source))+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1:(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+BSON.calculateObjectSize(e,r)+1;case"function":if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)||"[object RegExp]"==String.call(e))return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+(n?Buffer.byteLength(e.source,"utf8"):numberOfBytes(e.source))+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1;if(r&&null!=e.scope&&Object.keys(e.scope).length>0)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+4+(n?Buffer.byteLength(e.toString(),"utf8"):numberOfBytes(e.toString()))+1+BSON.calculateObjectSize(e.scope,r);if(r)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+(n?Buffer.byteLength(e.toString(),"utf8"):numberOfBytes(e.toString()))+1}return 0}var Long=require("./long").Long,Double=require("./double").Double,Timestamp=require("./timestamp").Timestamp,ObjectID=require("./objectid").ObjectID,Symbol=require("./symbol").Symbol,Code=require("./code").Code,MinKey=require("./min_key").MinKey,MaxKey=require("./max_key").MaxKey,DBRef=require("./db_ref").DBRef,Binary=require("./binary").Binary,BinaryParser=require("./binary_parser").BinaryParser,writeIEEE754=require("./float_parser").writeIEEE754,readIEEE754=require("./float_parser").readIEEE754,isDate=function(t){return"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)};BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.calculateObjectSize=function(t,e){var r=5;if(Array.isArray(t))for(var n=0;n<t.length;n++)r+=calculateElement(n.toString(),t[n],e);else{t.toBSON&&(t=t.toBSON());for(var i in t)r+=calculateElement(i,t[i],e)}return r},BSON.serializeWithBufferAndIndex=function(t,e,r,n,i){i=null==i?!1:i;var o=r.length;return r[n++]=255&o,r[n++]=o>>8&255,r[n++]=o>>16&255,r[n++]=o>>24&255,serializeObject(t,e,r,n,i)-1};var serializeObject=function(t,e,r,n,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)n=packElement(o.toString(),t[o],e,r,n,i);else{t.toBSON&&(t=t.toBSON());for(var f in t)"$db"!=f&&"$ref"!=f&&"$id"!=f&&BSON.checkKey(f,!e),n=packElement(f,t[f],e,r,n,i)}return r[n++]=0,n},stringToBytes=function(t){for(var e,r,n=[],i=0;i<t.length;i++){e=t.charCodeAt(i),r=[];do r.push(255&e),e>>=8;while(e);n=n.concat(r.reverse())}return n},numberOfBytes=function(t){for(var e,r,n=0,i=0;i<t.length;i++){e=t.charCodeAt(i),r=[];do r.push(255&e),e>>=8;while(e);n+=r.length}return n},writeToTypedArray=function(t,e,r){for(var n=stringToBytes(e),i=0;i<n.length;i++)t[r+i]=n[i];return n.length},supportsBuffer="undefined"!=typeof Buffer,packElement=function(t,e,r,n,i,o){switch(typeof e){case"string":n[i++]=BSON.BSON_DATA_STRING;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var s=supportsBuffer?Buffer.byteLength(e)+1:numberOfBytes(e)+1;return n[i+3]=s>>24&255,n[i+2]=s>>16&255,n[i+1]=s>>8&255,n[i]=255&s,i+=4,supportsBuffer?n.write(e,i,"utf8"):writeToTypedArray(n,e,i),i=i+s-1,n[i++]=0,i;case"number":if(Math.floor(e)===e&&e>=BSON.JS_INT_MIN&&e<=BSON.JS_INT_MAX)if(e>=BSON.BSON_INT32_MIN&&e<=BSON.BSON_INT32_MAX){n[i++]=BSON.BSON_DATA_INT;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0,n[i++]=255&e,n[i++]=e>>8&255,n[i++]=e>>16&255,n[i++]=e>>24&255}else if(e>=BSON.JS_INT_MIN&&e<=BSON.JS_INT_MAX){n[i++]=BSON.BSON_DATA_NUMBER;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0,writeIEEE754(n,e,i,"little",52,8),i+=8}else{n[i++]=BSON.BSON_DATA_LONG;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var u=Long.fromNumber(e),a=u.getLowBits(),h=u.getHighBits();n[i++]=255&a,n[i++]=a>>8&255,n[i++]=a>>16&255,n[i++]=a>>24&255,n[i++]=255&h,n[i++]=h>>8&255,n[i++]=h>>16&255,n[i++]=h>>24&255}else{n[i++]=BSON.BSON_DATA_NUMBER;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0,writeIEEE754(n,e,i,"little",52,8),i+=8}return i;case"undefined":n[i++]=BSON.BSON_DATA_NULL;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,i;case"boolean":n[i++]=BSON.BSON_DATA_BOOLEAN;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,n[i++]=e?1:0,i;case"object":if(null===e||e instanceof MinKey||e instanceof MaxKey||"MinKey"==e._bsontype||"MaxKey"==e._bsontype){n[i++]=null===e?BSON.BSON_DATA_NULL:e instanceof MinKey?BSON.BSON_DATA_MIN_KEY:BSON.BSON_DATA_MAX_KEY;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,i}if(e instanceof ObjectID||"ObjectID"==e._bsontype){n[i++]=BSON.BSON_DATA_OID;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,supportsBuffer?n.write(e.id,i,"binary"):writeToTypedArray(n,e.id,i),i+=12}if(e instanceof Date||isDate(e)){n[i++]=BSON.BSON_DATA_DATE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var c=Long.fromNumber(e.getTime()),a=c.getLowBits(),h=c.getHighBits();return n[i++]=255&a,n[i++]=a>>8&255,n[i++]=a>>16&255,n[i++]=a>>24&255,n[i++]=255&h,n[i++]=h>>8&255,n[i++]=h>>16&255,n[i++]=h>>24&255,i}if("undefined"!=typeof Buffer&&Buffer.isBuffer(e)){n[i++]=BSON.BSON_DATA_BINARY;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var s=e.length;return n[i++]=255&s,n[i++]=s>>8&255,n[i++]=s>>16&255,n[i++]=s>>24&255,n[i++]=BSON.BSON_BINARY_SUBTYPE_DEFAULT,e.copy(n,i,0,s),i+=s}if(e instanceof Long||e instanceof Timestamp||"Long"==e._bsontype||"Timestamp"==e._bsontype){n[i++]=e instanceof Long?BSON.BSON_DATA_LONG:BSON.BSON_DATA_TIMESTAMP;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var a=e.getLowBits(),h=e.getHighBits();return n[i++]=255&a,n[i++]=a>>8&255,n[i++]=a>>16&255,n[i++]=a>>24&255,n[i++]=255&h,n[i++]=h>>8&255,n[i++]=h>>16&255,n[i++]=h>>24&255,i}if(e instanceof Double||"Double"==e._bsontype){n[i++]=BSON.BSON_DATA_NUMBER;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,writeIEEE754(n,e,i,"little",52,8),i+=8}if(e instanceof Code||"Code"==e._bsontype){if(null!=e.scope&&Object.keys(e.scope).length>0){n[i++]=BSON.BSON_DATA_CODE_W_SCOPE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var l=BSON.calculateObjectSize(e.scope,o),p=e.code.toString(),_=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1,g=4+_+l+4;n[i++]=255&g,n[i++]=g>>8&255,n[i++]=g>>16&255,n[i++]=g>>24&255,n[i++]=255&_,n[i++]=_>>8&255,n[i++]=_>>16&255,n[i++]=_>>24&255,supportsBuffer?n.write(p,i,"utf8"):writeToTypedArray(n,p,i),i=i+_-1,n[i++]=0;var y=supportsBuffer?new Buffer(l):new Uint8Array(new ArrayBuffer(l));serializeObject(e.scope,r,y,0,o);var B=l;return n[i++]=255&B,n[i++]=B>>8&255,n[i++]=B>>16&255,n[i++]=B>>24&255,supportsBuffer?y.copy(n,i,0,l):n.set(y,i),i=i+B-5,n[i++]=0,i}n[i++]=BSON.BSON_DATA_CODE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var p=e.code.toString(),s=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1;return n[i++]=255&s,n[i++]=s>>8&255,n[i++]=s>>16&255,n[i++]=s>>24&255,supportsBuffer?n.write(p,i,"utf8"):writeToTypedArray(n,p,i),i=i+s-1,n[i++]=0,i}if(e instanceof Binary||"Binary"==e._bsontype){n[i++]=BSON.BSON_DATA_BINARY;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var d=e.value(!0),s=e.position;return n[i++]=255&s,n[i++]=s>>8&255,n[i++]=s>>16&255,n[i++]=s>>24&255,n[i++]=e.sub_type,e.sub_type==Binary.SUBTYPE_BYTE_ARRAY&&(n[i++]=255&s,n[i++]=s>>8&255,n[i++]=s>>16&255,n[i++]=s>>24&255),supportsBuffer?d.copy(n,i,0,e.position):n.set(d,i),i+=e.position}if(e instanceof Symbol||"Symbol"==e._bsontype){n[i++]=BSON.BSON_DATA_SYMBOL;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var s=supportsBuffer?Buffer.byteLength(e.value)+1:numberOfBytes(e.value)+1;return n[i++]=255&s,n[i++]=s>>8&255,n[i++]=s>>16&255,n[i++]=s>>24&255,n.write(e.value,i,"utf8"),i=i+s-1,n[i++]=0,i}if(e instanceof DBRef||"DBRef"==e._bsontype){n[i++]=BSON.BSON_DATA_OBJECT;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var O={$ref:e.namespace,$id:e.oid};null!=e.db&&(O.$db=e.db);var s=BSON.calculateObjectSize(O,o),b=BSON.serializeWithBufferAndIndex(O,r,n,i,o);return n[i++]=255&s,n[i++]=s>>8&255,n[i++]=s>>16&255,n[i++]=s>>24&255,n[b++]=0,b}if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)){n[i++]=BSON.BSON_DATA_REGEXP;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,supportsBuffer?n.write(e.source,i,"utf8"):writeToTypedArray(n,e.source,i),i+=supportsBuffer?Buffer.byteLength(e.source):numberOfBytes(e.source),n[i++]=0,e.global&&(n[i++]=115),e.ignoreCase&&(n[i++]=105),e.multiline&&(n[i++]=109),n[i++]=0,i}n[i++]=Array.isArray(e)?BSON.BSON_DATA_ARRAY:BSON.BSON_DATA_OBJECT;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var b=serializeObject(e,r,n,i+4,o),s=b-i;return n[i++]=255&s,n[i++]=s>>8&255,n[i++]=s>>16&255,n[i++]=s>>24&255,b;case"function":if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)||"[object RegExp]"==String.call(e)){n[i++]=BSON.BSON_DATA_REGEXP;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,n.write(e.source,i,"utf8"),i+=supportsBuffer?Buffer.byteLength(e.source):numberOfBytes(e.source),n[i++]=0,e.global&&(n[i++]=115),e.ignoreCase&&(n[i++]=105),e.multiline&&(n[i++]=109),n[i++]=0,i}if(o&&null!=e.scope&&Object.keys(e.scope).length>0){n[i++]=BSON.BSON_DATA_CODE_W_SCOPE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var l=BSON.calculateObjectSize(e.scope,o),p=e.toString(),_=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1,g=4+_+l;n[i++]=255&g,n[i++]=g>>8&255,n[i++]=g>>16&255,n[i++]=g>>24&255,n[i++]=255&_,n[i++]=_>>8&255,n[i++]=_>>16&255,n[i++]=_>>24&255,supportsBuffer?n.write(p,i,"utf8"):writeToTypedArray(n,p,i),i=i+_-1,n[i++]=0;var y=new Buffer(l);serializeObject(e.scope,r,y,0,o);var B=l-4;return n[i++]=255&B,n[i++]=B>>8&255,n[i++]=B>>16&255,n[i++]=B>>24&255,y.copy(n,i,0,l),i=i+B-5,n[i++]=0,i}if(o){n[i++]=BSON.BSON_DATA_CODE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var p=e.toString(),s=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1;return n[i++]=255&s,n[i++]=s>>8&255,n[i++]=s>>16&255,n[i++]=s>>24&255,supportsBuffer?n.write(p,i,"utf8"):writeToTypedArray(n,p,i),i=i+s-1,n[i++]=0,i}}return i};BSON.serialize=function(t,e,r,n){if(null==t||"object"!=typeof t||Array.isArray(t))throw new Error("Only javascript objects supported");var i=null,o=BSON.calculateObjectSize(t,n);return(i="undefined"!=typeof Buffer)?(i=new Buffer(o),r=!0):i="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(o)):new Array(o),BSON.serializeWithBufferAndIndex(t,e,i,0,n),i};var functionCache=BSON.functionCache={},table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],crc32=function(t,e,r){var n=0,i=0,o=0;n=-1^n;for(var f=e,s=r;s>f;f++)o=255&(n^t[f]),i=table[o],n=n>>>8^i;return-1^n};BSON.deserializeStream=function(t,e,r,n,i,o){o=null!=o?o:{};for(var f=e,s=0;r>s;s++){var u=t[f]|t[f+1]<<8|t[f+2]<<16|t[f+3]<<24;o.index=f,n[i+s]=BSON.deserialize(t,o),f+=u}return f};var isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},convertUint8ArrayToUtf8String=function(t,e,r){return BinaryParser.decode_utf8(convertArraytoUtf8BinaryString(t,e,r))},convertArraytoUtf8BinaryString=function(t,e,r){for(var n="",i=e;r>i;i++)n+=String.fromCharCode(t[i]);return n};BSON.deserialize=function(t,e,r){e=null==e?{}:e;var n=null==e.evalFunctions?!1:e.evalFunctions,i=null==e.cacheFunctions?!1:e.cacheFunctions,o=null==e.cacheFunctionsCrc32?!1:e.cacheFunctionsCrc32,f=e.promoteLongs||!0;if(t.length<5)throw new Error("corrupt bson message < 5 bytes long");var s="number"==typeof e.index?e.index:0,u=function(){for(var e=s;0!==t[e];)e++;var r=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",s,e):convertUint8ArrayToUtf8String(t,s,e);return s=e+1,r},a=r?[]:{},h=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;if(5>h||h>t.length)throw new Error("corrupt bson message");for(;;){var c=t[s++];if(0==c)break;var l=u();switch(c){case BSON.BSON_DATA_OID:var p=supportsBuffer&&Buffer.isBuffer(t)?t.toString("binary",s,s+12):convertArraytoUtf8BinaryString(t,s,s+12);
a[l]=new ObjectID(p),s+=12;break;case BSON.BSON_DATA_STRING:var _=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;a[l]=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",s,s+_-1):convertUint8ArrayToUtf8String(t,s,s+_-1),s+=_;break;case BSON.BSON_DATA_INT:a[l]=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;break;case BSON.BSON_DATA_NUMBER:a[l]=readIEEE754(t,s,"little",52,8),s+=8;break;case BSON.BSON_DATA_DATE:var g=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24,y=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;a[l]=new Date(new Long(g,y).toNumber());break;case BSON.BSON_DATA_BOOLEAN:a[l]=1==t[s++];break;case BSON.BSON_DATA_NULL:a[l]=null;break;case BSON.BSON_DATA_BINARY:var B=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24,d=t[s++];if(null!=t.slice)d==Binary.SUBTYPE_BYTE_ARRAY&&(B=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24),a[l]=new Binary(t.slice(s,s+B),d);else{var O="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(B)):new Array(B);d==Binary.SUBTYPE_BYTE_ARRAY&&(B=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24);for(var b=0;B>b;b++)O[b]=t[s+b];a[l]=new Binary(O,d)}s+=B;break;case BSON.BSON_DATA_ARRAY:e.index=s;var m=t[s]|t[s+1]<<8|t[s+2]<<16|t[s+3]<<24;a[l]=BSON.deserialize(t,e,!0),s+=m;break;case BSON.BSON_DATA_OBJECT:e.index=s;var m=t[s]|t[s+1]<<8|t[s+2]<<16|t[s+3]<<24;a[l]=BSON.deserialize(t,e,!1),s+=m;break;case BSON.BSON_DATA_REGEXP:for(var N=u(),S=u(),A=new Array(S.length),b=0;b<S.length;b++)switch(S[b]){case"m":A[b]="m";break;case"s":A[b]="g";break;case"i":A[b]="i"}a[l]=new RegExp(N,A.join(""));break;case BSON.BSON_DATA_LONG:var g=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24,y=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24,v=new Long(g,y);a[l]=f&&v.lessThanOrEqual(JS_INT_MAX_LONG)&&v.greaterThanOrEqual(JS_INT_MIN_LONG)?v.toNumber():v;break;case BSON.BSON_DATA_SYMBOL:var _=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;a[l]=new Symbol(t.toString("utf8",s,s+_-1)),s+=_;break;case BSON.BSON_DATA_TIMESTAMP:var g=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24,y=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;a[l]=new Timestamp(g,y);break;case BSON.BSON_DATA_MIN_KEY:a[l]=new MinKey;break;case BSON.BSON_DATA_MAX_KEY:a[l]=new MaxKey;break;case BSON.BSON_DATA_CODE:var _=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24,w=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",s,s+_-1):convertUint8ArrayToUtf8String(t,s,s+_-1);if(n){if(i){var T=o?crc32(w):w;a[l]=isolateEvalWithHash(functionCache,T,w,a)}else a[l]=isolateEval(w)}else a[l]=new Code(w,{});s+=_;break;case BSON.BSON_DATA_CODE_W_SCOPE:var _=(t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24,t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24),w=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",s,s+_-1):convertUint8ArrayToUtf8String(t,s,s+_-1);s+=_,e.index=s;var m=t[s]|t[s+1]<<8|t[s+2]<<16|t[s+3]<<24,E=BSON.deserialize(t,e,!1);if(s+=m,n){if(i){var T=o?crc32(w):w;a[l]=isolateEvalWithHash(functionCache,T,w,a)}else a[l]=isolateEval(w);a[l].scope=E}else a[l]=new Code(w,E)}}return null!=a.$id&&(a=new DBRef(a.$ref,a.$id,a.$db)),a},BSON.checkKey=function(t,e){if(t.length){if(~t.indexOf("\x00"))throw Error("key "+t+" must not contain null bytes");if(!e){if("$"==t[0])throw Error("key "+t+" must not start with '$'");if(~t.indexOf("."))throw Error("key "+t+" must not contain '.'")}}},BSON.prototype.deserialize=function(t,e){return BSON.deserialize(t,e)},BSON.prototype.deserializeStream=function(t,e,r,n,i,o){return BSON.deserializeStream(t,e,r,n,i,o)},BSON.prototype.serialize=function(t,e,r,n){return BSON.serialize(t,e,r,n)},BSON.prototype.calculateObjectSize=function(t,e){return BSON.calculateObjectSize(t,e)},BSON.prototype.serializeWithBufferAndIndex=function(t,e,r,n,i){return BSON.serializeWithBufferAndIndex(t,e,r,n,i)},exports.Code=Code,exports.Symbol=Symbol,exports.BSON=BSON,exports.DBRef=DBRef,exports.Binary=Binary,exports.ObjectID=ObjectID,exports.Long=Long,exports.Timestamp=Timestamp,exports.Double=Double,exports.MinKey=MinKey,exports.MaxKey=MaxKey},code:function(t,e){function r(t,e){return this instanceof r?(this._bsontype="Code",this.code=t,void(this.scope=null==e?{}:e)):new r(t,e)}r.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},e.Code=r},db_ref:function(t,e){function r(t,e,n){return this instanceof r?(this._bsontype="DBRef",this.namespace=t,this.oid=e,void(this.db=n)):new r(t,e,n)}r.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},e.DBRef=r},"double":function(t,e){function r(t){return this instanceof r?(this._bsontype="Double",void(this.value=t)):new r(t)}r.prototype.valueOf=function(){return this.value},r.prototype.toJSON=function(){return this.value},e.Double=r},float_parser:function(t,e){var r=function(t,e,r,n,i){var o,f,s="big"===r,u=8*i-n-1,a=(1<<u)-1,h=a>>1,c=-7,l=s?0:i-1,p=s?1:-1,_=t[e+l];for(l+=p,o=_&(1<<-c)-1,_>>=-c,c+=u;c>0;o=256*o+t[e+l],l+=p,c-=8);for(f=o&(1<<-c)-1,o>>=-c,c+=n;c>0;f=256*f+t[e+l],l+=p,c-=8);if(0===o)o=1-h;else{if(o===a)return f?0/0:1/0*(_?-1:1);f+=Math.pow(2,n),o-=h}return(_?-1:1)*f*Math.pow(2,o-n)},n=function(t,e,r,n,i,o){var f,s,u,a="big"===n,h=8*o-i-1,c=(1<<h)-1,l=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,_=a?o-1:0,g=a?-1:1,y=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(s=isNaN(e)?1:0,f=c):(f=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-f))<1&&(f--,u*=2),e+=f+l>=1?p/u:p*Math.pow(2,1-l),e*u>=2&&(f++,u/=2),f+l>=c?(s=0,f=c):f+l>=1?(s=(e*u-1)*Math.pow(2,i),f+=l):(s=e*Math.pow(2,l-1)*Math.pow(2,i),f=0));i>=8;t[r+_]=255&s,_+=g,s/=256,i-=8);for(f=f<<i|s,h+=i;h>0;t[r+_]=255&f,_+=g,f/=256,h-=8);t[r+_-g]|=128*y};e.readIEEE754=r,e.writeIEEE754=n},index:function(t,e,r,n){try{e.BSONPure=n("./bson"),e.BSONNative=n("../../ext")}catch(i){}["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long"].forEach(function(t){var r=n("./"+t);for(var i in r)e[i]=r[i]}),e["native"]=function(){var t={};return["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","../../ext"].forEach(function(e){var r=n("./"+e);for(var i in r)t[i]=r[i]}),t},e.pure=function(){var t={};return["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","././bson"].forEach(function(e){var r=n("./"+e);for(var i in r)t[i]=r[i]}),t}},"long":function(t,e){function r(t,e){return this instanceof r?(this._bsontype="Long",this.low_=0|t,void(this.high_=0|e)):new r(t,e)}r.prototype.toInt=function(){return this.low_},r.prototype.toNumber=function(){return this.high_*r.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},r.prototype.toJSON=function(){return this.toString()},r.prototype.toString=function(t){var e=t||10;if(2>e||e>36)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(r.MIN_VALUE)){var n=r.fromNumber(e),i=this.div(n),o=i.multiply(n).subtract(this);return i.toString(e)+o.toInt().toString(e)}return"-"+this.negate().toString(e)}for(var f=r.fromNumber(Math.pow(e,6)),o=this,s="";;){var u=o.div(f),a=o.subtract(u.multiply(f)).toInt(),h=a.toString(e);if(o=u,o.isZero())return h+s;for(;h.length<6;)h="0"+h;s=""+h+s}},r.prototype.getHighBits=function(){return this.high_},r.prototype.getLowBits=function(){return this.low_},r.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:r.TWO_PWR_32_DBL_+this.low_},r.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(r.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high_?e+33:e+1},r.prototype.isZero=function(){return 0==this.high_&&0==this.low_},r.prototype.isNegative=function(){return this.high_<0},r.prototype.isOdd=function(){return 1==(1&this.low_)},r.prototype.equals=function(t){return this.high_==t.high_&&this.low_==t.low_},r.prototype.notEquals=function(t){return this.high_!=t.high_||this.low_!=t.low_},r.prototype.lessThan=function(t){return this.compare(t)<0},r.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},r.prototype.greaterThan=function(t){return this.compare(t)>0},r.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},r.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.subtract(t).isNegative()?-1:1},r.prototype.negate=function(){return this.equals(r.MIN_VALUE)?r.MIN_VALUE:this.not().add(r.ONE)},r.prototype.add=function(t){var e=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,f=t.high_>>>16,s=65535&t.high_,u=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=o+a,l+=p>>>16,p&=65535,l+=i+u,c+=l>>>16,l&=65535,c+=n+s,h+=c>>>16,c&=65535,h+=e+f,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.subtract=function(t){return this.add(t.negate())},r.prototype.multiply=function(t){if(this.isZero())return r.ZERO;if(t.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE))return t.isOdd()?r.MIN_VALUE:r.ZERO;if(t.equals(r.MIN_VALUE))return this.isOdd()?r.MIN_VALUE:r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(r.TWO_PWR_24_)&&t.lessThan(r.TWO_PWR_24_))return r.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,f=t.high_>>>16,s=65535&t.high_,u=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=o*a,l+=p>>>16,p&=65535,l+=i*a,c+=l>>>16,l&=65535,l+=o*u,c+=l>>>16,l&=65535,c+=n*a,h+=c>>>16,c&=65535,c+=i*u,h+=c>>>16,c&=65535,c+=o*s,h+=c>>>16,c&=65535,h+=e*a+n*u+i*s+o*f,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE)){if(t.equals(r.ONE)||t.equals(r.NEG_ONE))return r.MIN_VALUE;if(t.equals(r.MIN_VALUE))return r.ONE;var e=this.shiftRight(1),n=e.div(t).shiftLeft(1);if(n.equals(r.ZERO))return t.isNegative()?r.ONE:r.NEG_ONE;var i=this.subtract(t.multiply(n)),o=n.add(i.div(t));return o}if(t.equals(r.MIN_VALUE))return r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();for(var f=r.ZERO,i=this;i.greaterThanOrEqual(t);){for(var n=Math.max(1,Math.floor(i.toNumber()/t.toNumber())),s=Math.ceil(Math.log(n)/Math.LN2),u=48>=s?1:Math.pow(2,s-48),a=r.fromNumber(n),h=a.multiply(t);h.isNegative()||h.greaterThan(i);)n-=u,a=r.fromNumber(n),h=a.multiply(t);a.isZero()&&(a=r.ONE),f=f.add(a),i=i.subtract(h)}return f},r.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},r.prototype.not=function(){return r.fromBits(~this.low_,~this.high_)},r.prototype.and=function(t){return r.fromBits(this.low_&t.low_,this.high_&t.high_)},r.prototype.or=function(t){return r.fromBits(this.low_|t.low_,this.high_|t.high_)},r.prototype.xor=function(t){return r.fromBits(this.low_^t.low_,this.high_^t.high_)},r.prototype.shiftLeft=function(t){if(t&=63,0==t)return this;var e=this.low_;if(32>t){var n=this.high_;return r.fromBits(e<<t,n<<t|e>>>32-t)}return r.fromBits(0,e<<t-32)},r.prototype.shiftRight=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>t)}return r.fromBits(e>>t-32,e>=0?0:-1)},r.prototype.shiftRightUnsigned=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>>t)}return 32==t?r.fromBits(e,0):r.fromBits(e>>>t-32,0)},r.fromInt=function(t){if(t>=-128&&128>t){var e=r.INT_CACHE_[t];if(e)return e}var n=new r(0|t,0>t?-1:0);return t>=-128&&128>t&&(r.INT_CACHE_[t]=n),n},r.fromNumber=function(t){return isNaN(t)||!isFinite(t)?r.ZERO:t<=-r.TWO_PWR_63_DBL_?r.MIN_VALUE:t+1>=r.TWO_PWR_63_DBL_?r.MAX_VALUE:0>t?r.fromNumber(-t).negate():new r(t%r.TWO_PWR_32_DBL_|0,t/r.TWO_PWR_32_DBL_|0)},r.fromBits=function(t,e){return new r(t,e)},r.fromString=function(t,e){if(0==t.length)throw Error("number format error: empty string");var n=e||10;if(2>n||n>36)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return r.fromString(t.substring(1),n).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var i=r.fromNumber(Math.pow(n,8)),o=r.ZERO,f=0;f<t.length;f+=8){var s=Math.min(8,t.length-f),u=parseInt(t.substring(f,f+s),n);if(8>s){var a=r.fromNumber(Math.pow(n,s));o=o.multiply(a).add(r.fromNumber(u))}else o=o.multiply(i),o=o.add(r.fromNumber(u))}return o},r.INT_CACHE_={},r.TWO_PWR_16_DBL_=65536,r.TWO_PWR_24_DBL_=1<<24,r.TWO_PWR_32_DBL_=r.TWO_PWR_16_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_31_DBL_=r.TWO_PWR_32_DBL_/2,r.TWO_PWR_48_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_64_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_32_DBL_,r.TWO_PWR_63_DBL_=r.TWO_PWR_64_DBL_/2,r.ZERO=r.fromInt(0),r.ONE=r.fromInt(1),r.NEG_ONE=r.fromInt(-1),r.MAX_VALUE=r.fromBits(-1,2147483647),r.MIN_VALUE=r.fromBits(0,-2147483648),r.TWO_PWR_24_=r.fromInt(1<<24),e.Long=r},max_key:function(t,e){function r(){return this instanceof r?void(this._bsontype="MaxKey"):new r}e.MaxKey=r},min_key:function(t,e){function r(){return this instanceof r?void(this._bsontype="MinKey"):new r}e.MinKey=r},objectid:function(t,e,r,n){for(var i=n("./binary_parser").BinaryParser,o=parseInt(16777215*Math.random(),10),f=new RegExp("^[0-9a-fA-F]{24}$"),s=function h(t,e){if(!(this instanceof h))return new h(t,e);this._bsontype="ObjectID";if(null!=t&&"number"!=typeof t&&12!=t.length&&24!=t.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(null==t||"number"==typeof t)this.id=this.generate(t);else{if(null==t||12!==t.length){if(f.test(t))return h.createFromHexString(t);throw new Error("Value passed in is not a valid 24 character hex string")}this.id=t}h.cacheHexString&&(this.__id=this.toHexString())},u=[],a=0;256>a;a++)u[a]=(15>=a?"0":"")+a.toString(16);s.prototype.toHexString=function(){if(s.cacheHexString&&this.__id)return this.__id;for(var t="",e=0;e<this.id.length;e++)t+=u[this.id.charCodeAt(e)];return s.cacheHexString&&(this.__id=t),t},s.prototype.get_inc=function(){return s.index=(s.index+1)%16777215},s.prototype.getInc=function(){return this.get_inc()},s.prototype.generate=function(t){if("number"==typeof t)var e=i.encodeInt(t,32,!0,!0),r=i.encodeInt(o,24,!1),n=i.fromShort("undefined"==typeof process?Math.floor(1e5*Math.random()):process.pid),f=i.encodeInt(this.get_inc(),24,!1,!0);else var s=parseInt(Date.now()/1e3,10),e=i.encodeInt(s,32,!0,!0),r=i.encodeInt(o,24,!1),n=i.fromShort("undefined"==typeof process?Math.floor(1e5*Math.random()):process.pid),f=i.encodeInt(this.get_inc(),24,!1,!0);return e+r+n+f},s.prototype.toString=function(){return this.toHexString()},s.prototype.inspect=s.prototype.toString,s.prototype.toJSON=function(){return this.toHexString()},s.prototype.equals=function(t){var e=t instanceof s||t.toHexString?t.id:s.createFromHexString(t).id;return this.id===e},s.prototype.getTimestamp=function(){var t=new Date;return t.setTime(1e3*Math.floor(i.decodeInt(this.id.substring(0,4),32,!0,!0))),t},s.index=parseInt(16777215*Math.random(),10),s.createPk=function(){return new s},s.createFromTime=function(t){var e=i.encodeInt(t,32,!0,!0)+i.encodeInt(0,64,!0,!0);return new s(e)},s.createFromHexString=function(t){if("undefined"==typeof t||null!=t&&24!=t.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");var e=t.length;if(e>24)throw new Error("Id cannot be longer than 12 bytes");for(var r,n,o="",f=0;e>f;f+=2)r=t.substr(f,2),n=parseInt(r,16),o+=i.fromByte(n);return new s(o,t)},Object.defineProperty(s.prototype,"generationTime",{enumerable:!0,get:function(){return Math.floor(i.decodeInt(this.id.substring(0,4),32,!0,!0))},set:function(t){var t=i.encodeInt(t,32,!0,!0);this.id=t+this.id.substr(4),this.toHexString()}}),e.ObjectID=s,e.ObjectId=s},symbol:function(t,e){function r(t){return this instanceof r?(this._bsontype="Symbol",void(this.value=t)):new r(t)}r.prototype.valueOf=function(){return this.value},r.prototype.toString=function(){return this.value},r.prototype.inspect=function(){return this.value},r.prototype.toJSON=function(){return this.value},e.Symbol=r},timestamp:function(t,e){function r(t,e){return this instanceof r?(this._bsontype="Timestamp",this.low_=0|t,void(this.high_=0|e)):new r(t,e)}r.prototype.toInt=function(){return this.low_},r.prototype.toNumber=function(){return this.high_*r.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},r.prototype.toJSON=function(){return this.toString()},r.prototype.toString=function(t){var e=t||10;if(2>e||e>36)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(r.MIN_VALUE)){var n=r.fromNumber(e),i=this.div(n),o=i.multiply(n).subtract(this);return i.toString(e)+o.toInt().toString(e)}return"-"+this.negate().toString(e)}for(var f=r.fromNumber(Math.pow(e,6)),o=this,s="";;){var u=o.div(f),a=o.subtract(u.multiply(f)).toInt(),h=a.toString(e);if(o=u,o.isZero())return h+s;for(;h.length<6;)h="0"+h;s=""+h+s}},r.prototype.getHighBits=function(){return this.high_},r.prototype.getLowBits=function(){return this.low_},r.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:r.TWO_PWR_32_DBL_+this.low_},r.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(r.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high_?e+33:e+1},r.prototype.isZero=function(){return 0==this.high_&&0==this.low_},r.prototype.isNegative=function(){return this.high_<0},r.prototype.isOdd=function(){return 1==(1&this.low_)},r.prototype.equals=function(t){return this.high_==t.high_&&this.low_==t.low_},r.prototype.notEquals=function(t){return this.high_!=t.high_||this.low_!=t.low_},r.prototype.lessThan=function(t){return this.compare(t)<0},r.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},r.prototype.greaterThan=function(t){return this.compare(t)>0},r.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},r.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.subtract(t).isNegative()?-1:1},r.prototype.negate=function(){return this.equals(r.MIN_VALUE)?r.MIN_VALUE:this.not().add(r.ONE)},r.prototype.add=function(t){var e=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,f=t.high_>>>16,s=65535&t.high_,u=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=o+a,l+=p>>>16,p&=65535,l+=i+u,c+=l>>>16,l&=65535,c+=n+s,h+=c>>>16,c&=65535,h+=e+f,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.subtract=function(t){return this.add(t.negate())},r.prototype.multiply=function(t){if(this.isZero())return r.ZERO;if(t.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE))return t.isOdd()?r.MIN_VALUE:r.ZERO;if(t.equals(r.MIN_VALUE))return this.isOdd()?r.MIN_VALUE:r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(r.TWO_PWR_24_)&&t.lessThan(r.TWO_PWR_24_))return r.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,f=t.high_>>>16,s=65535&t.high_,u=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=o*a,l+=p>>>16,p&=65535,l+=i*a,c+=l>>>16,l&=65535,l+=o*u,c+=l>>>16,l&=65535,c+=n*a,h+=c>>>16,c&=65535,c+=i*u,h+=c>>>16,c&=65535,c+=o*s,h+=c>>>16,c&=65535,h+=e*a+n*u+i*s+o*f,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE)){if(t.equals(r.ONE)||t.equals(r.NEG_ONE))return r.MIN_VALUE;if(t.equals(r.MIN_VALUE))return r.ONE;var e=this.shiftRight(1),n=e.div(t).shiftLeft(1);if(n.equals(r.ZERO))return t.isNegative()?r.ONE:r.NEG_ONE;var i=this.subtract(t.multiply(n)),o=n.add(i.div(t));return o}if(t.equals(r.MIN_VALUE))return r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();for(var f=r.ZERO,i=this;i.greaterThanOrEqual(t);){for(var n=Math.max(1,Math.floor(i.toNumber()/t.toNumber())),s=Math.ceil(Math.log(n)/Math.LN2),u=48>=s?1:Math.pow(2,s-48),a=r.fromNumber(n),h=a.multiply(t);h.isNegative()||h.greaterThan(i);)n-=u,a=r.fromNumber(n),h=a.multiply(t);a.isZero()&&(a=r.ONE),f=f.add(a),i=i.subtract(h)}return f},r.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},r.prototype.not=function(){return r.fromBits(~this.low_,~this.high_)},r.prototype.and=function(t){return r.fromBits(this.low_&t.low_,this.high_&t.high_)},r.prototype.or=function(t){return r.fromBits(this.low_|t.low_,this.high_|t.high_)},r.prototype.xor=function(t){return r.fromBits(this.low_^t.low_,this.high_^t.high_)},r.prototype.shiftLeft=function(t){if(t&=63,0==t)return this;var e=this.low_;if(32>t){var n=this.high_;return r.fromBits(e<<t,n<<t|e>>>32-t)}return r.fromBits(0,e<<t-32)},r.prototype.shiftRight=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>t)}return r.fromBits(e>>t-32,e>=0?0:-1)},r.prototype.shiftRightUnsigned=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>>t)}return 32==t?r.fromBits(e,0):r.fromBits(e>>>t-32,0)},r.fromInt=function(t){if(t>=-128&&128>t){var e=r.INT_CACHE_[t];if(e)return e}var n=new r(0|t,0>t?-1:0);return t>=-128&&128>t&&(r.INT_CACHE_[t]=n),n},r.fromNumber=function(t){return isNaN(t)||!isFinite(t)?r.ZERO:t<=-r.TWO_PWR_63_DBL_?r.MIN_VALUE:t+1>=r.TWO_PWR_63_DBL_?r.MAX_VALUE:0>t?r.fromNumber(-t).negate():new r(t%r.TWO_PWR_32_DBL_|0,t/r.TWO_PWR_32_DBL_|0)},r.fromBits=function(t,e){return new r(t,e)},r.fromString=function(t,e){if(0==t.length)throw Error("number format error: empty string");var n=e||10;if(2>n||n>36)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return r.fromString(t.substring(1),n).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var i=r.fromNumber(Math.pow(n,8)),o=r.ZERO,f=0;f<t.length;f+=8){var s=Math.min(8,t.length-f),u=parseInt(t.substring(f,f+s),n);if(8>s){var a=r.fromNumber(Math.pow(n,s));o=o.multiply(a).add(r.fromNumber(u))}else o=o.multiply(i),o=o.add(r.fromNumber(u))}return o},r.INT_CACHE_={},r.TWO_PWR_16_DBL_=65536,r.TWO_PWR_24_DBL_=1<<24,r.TWO_PWR_32_DBL_=r.TWO_PWR_16_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_31_DBL_=r.TWO_PWR_32_DBL_/2,r.TWO_PWR_48_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_64_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_32_DBL_,r.TWO_PWR_63_DBL_=r.TWO_PWR_64_DBL_/2,r.ZERO=r.fromInt(0),r.ONE=r.fromInt(1),r.NEG_ONE=r.fromInt(-1),r.MAX_VALUE=r.fromBits(-1,2147483647),r.MIN_VALUE=r.fromBits(0,-2147483648),r.TWO_PWR_24_=r.fromInt(1<<24),e.Timestamp=r}}),"undefined"!=typeof module&&module.exports&&(module.exports=bson,module.parent||bson()),"undefined"!=typeof window&&"undefined"==typeof require&&(window.require=bson.require),function(){function t(t,e,r){for(property in e)t[property]=e[property];for(property in r)t[property]=r[property];return t}var e,r=this;e="undefined"!=typeof exports?window.Oneline||{}:r.Oneline=window.Oneline||{},min=Math.min,max=Math.max,pow=Math.pow,sqrt=Math.sqrt,log=Math.log,floor=Math.floor,slice=Array.slice,splice=Array.splice,every=Array.every,websocket={},navigator=window.navigator?window.navigator:[],window.BSON=window.BSON||bson().BSON,BSON.stringify=function(t){return O.uint8ToString(BSON.serialize(t))},BSON.parse=function(t){return BSON.deserialize(O.stringToUint8(t))},e.interop=BSON,e.socket=e.socket||[],e.settings=e.settings||{},e.freq=e.freq=e.freq||1e3,e.host=e.host||"localhost",e.port=e.port||9e3,e.protoline=e.protoline||[],e.objects=e.objects||[],e.loaded=0,e.setup=function(t){e.settings=t,e.port=t.port||e.port,e.host=t.host||e.host,e.type="bind"===t.type?"bind":"auto",e.on=t.on||"click",e.target=t.target,t.server=t.module||t.server,e.settings.server=t.server.match(/ws\:\/\//)?t.server:t.server="ws://"+e.host+":"+e.port+"/"+t.server,e.socket=window.WebSocket?new window.WebSocket(t.server):MozWebSocket(t.server),e.interop="undefined"!=typeof t.interop&&"json"===t.interop?JSON:BSON,e.freq="undefined"!=typeof t.freq?t.freq:e.freq,e.socket.onopen=function(){e.loaded=1},e.socket.onmessage=function(t){console.log(O.interop.parse(t.data))},e.target=document.getElementById(e.target)},e.agent=function(){},e.nodes=function(){},e.stream=function(t){return t=t||{},t.pipeline=t.pipeline||O.protoline,O.pipeline({},t.pipeline,function(t){console.log(t)}).run()},e.value=function(t,e){return{op:t,value:e}},e.moment=function(){return{start:0,end:3600}},e.echo=e.echo=function(t,r){return e.echo.options=t,r||e.objects.push(clone(e.echo(t,1))),{run:function(t){this.m=t||{},this.m.echo={},this.m.echo.limit=O.echo.options.limit,this.state=1}}},e.geolocation=e.geo=function(t,r){return e.geolocation.options=t,r||e.objects.push(clone(e.geo(t,1))),{run:function(t){this.m=t||{},this.m.geo={},this.state=0,this.m.geo.every=O.geolocation.options.every,this.m.geo.range=O.geolocation.options.range;var e=this;navigator.geolocation.getCurrentPosition(function(t){e.m.geo.lat=t.coords.longitude,e.m.geo.lng=t.coords.latitude,e.m.geo.range=O.geolocation.options.range,e.state=1})}}},e.event=function(t,r){return e.event.options=t,r||e.objects.push(clone(e.event(t,1))),{run:function(t){this.m=t||{},this.m.event=e.event.options,this.state=1}}},e.generic=function(t,r){return e.generic.options=t,r||e.objects.push(clone(e.generic(t,1))),{run:function(t){this.m=t||{},this.m.generic={},this.m.generic.type=e.generic.options.type,this.m.generic.data=e.generic.options.data,this.state=1,console.log(this)}}},e.time=function(t){return e.time.options=t,ready||e.objects.push(clone(e.time(t,1))),{run:function(t){this.m=t||{},this.m.time={},this.m.time.start=e.time.options.moment.start,this.m.time.end=e.time.options.moment.end,this.state=1}}},e.random=function(t){return e.random.options=t,ready||e.objects.push(clone(e.random(t,1))),{run:function(t){this.m=t||{},this.m.random={},this.m.random.amount=e.random.options.amount,this.state=1}}},e.pipeline=function(r,n){return O.agent="undefined"!=typeof r&&"function"!=typeof r?r:{},"undefined"!=typeof n&&"function"!=typeof n&&(O.objects=n),O.callback=arguments[arguments.length-1],O.protoline.push(this),O.linetype=e.type,O.provider="bind"===O.linetype?"Timeout":"Interval",O.runner="Interval","bind"===e.type&&"undefined"!=typeof e.target&&e.target.tagName&&(e.target["on"+e.on]=function(){return e.pipeline(r,O.objects,O.callback).run()}),{stop:function(){return O.signalStop=1},run:function(){O.t=window["set"+O.provider](function(){if(!e.running){if(!e.loaded)return O.connector.connect();if(e.signalStop||2===O.socket.readyState||3===O.socket.readyState)return O.connector.disconnect();O.running=1,O.socket.onmessage=function(t){return O.callback(O.interop.parse(t.data))};var r,n={},i=0,o={},f=0;for(var f in O.objects)O.objects[parseInt(f)].run(n),O.oot=window["set"+O.runner](function(){(0===i||1===O.objects[i-1].state)&&"object"==typeof O.objects[i]&&1===O.objects[i].state&&(n=t(n,O.objects[i].m),i++,window["clear"+O.runner](O.oot))},1);O.ooot=window["set"+O.runner](function(){i===O.objects.length&&(o.packet=n,r=(new Date).getTime(),o.packet.timestamp=r,o.packet.interop=O.interop,o.uuid=O.uuid(),O.socket.send(O.interop.stringify(o)),"function"==typeof O.callback&&O.callback(o),O.running=0,window["clear"+O.runner](O.ooot))},1)}},O.freq)}}},e.sound=function(t){return e.sound.options=t,{run:function(t){this.m=t||{},this.m.sound={},this.m.sound.length=e.sound.options.length||60,this.m.sound.field=e.sound.options.field;var r=this;e.speech=new webkitSpeechRecognition,e.speech.onstart=function(){},e.speech.onresult=function(t){console.log(t),r.state=1},e.speech.lang=e.sound.options.lang||"en-GB",e.speech.start()}}},e.connector={connect:function(){return 0!==O.socket.readyState?O.setup(O.settings):void 0},disconnect:function(){return O.loaded=0,3!==O.socket.readyState?O.socket.close():void 0}},e.uuid=function(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)},e.uint8ToString=function(t){var e="[";for(var r in t)e+=r==t.length-1?t[r].toString()+"]":t[r].toString()+", ";return e},e.stringToUint8=function(t){for(var e=t.match(/(\d+)/g),r=[],n=0;n!=e.length;n++)r.push(parseInt(e[n]));return r},window.O=window.ol=e}.call(this);var object_create=Object.create;"function"!=typeof object_create&&(object_create=function(t){function e(){}return e.prototype=t,new e});
